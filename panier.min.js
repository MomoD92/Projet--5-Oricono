'use strict';let products=JSON.parse(localStorage.getItem("produit")),total=document.getElementById("finalPrice"),mainPanier=document.getElementById("main");
if(0<localStorage.length)total.innerHTML=prixTotalCalculer()+" \u20ac (euros)",products.forEach(a=>{let b=document.createElement("div");b.classList.add("row","m-2","pt-3","panierLine");mainPanier.appendChild(b);var d=document.createElement("div");d.classList.add("col-md-3","col-lg-2");var c=document.createElement("img");c.src=a.image;c.alt=a.name;c.className="img-fluid";d.appendChild(c);b.appendChild(d);d=document.createElement("div");d.className="col-md-4";b.appendChild(d);c=document.createElement("a");
c.href=`./produit.html?id=${a._id}`;var e=document.createElement("h2");e.textContent=a.name;c.appendChild(e);d.appendChild(c);c=document.createElement("p");e=document.createElement("strong");e.textContent="Quantit\u00e9 : ";var f=document.createElement("span");f.innerHTML=a.quantite;c.appendChild(e);c.appendChild(f);d.appendChild(c);c=document.createElement("p");e=document.createElement("strong");e.textContent="Lentilles : ";f=document.createElement("span");f.innerHTML=a.lense;c.appendChild(e);c.appendChild(f);
d.appendChild(c);d=document.createElement("div");d.classList.add("col-md-5","col-lg-4");c=document.createElement("p");c.className="prixProduitPanier";d.appendChild(c);e=document.createElement("strong");e.textContent="Prix : ";f=document.createElement("span");f.innerHTML=a.totalPrice+"\u20ac";c.appendChild(e);c.appendChild(f);b.appendChild(d);d=document.createElement("div");d.className="col-md-6";d.innerHTML+=`
                      <button class="btn btn-danger mb-3" onclick=" produitSupprimer('${a._id}')">Supprimer</button>  
             `;b.appendChild(d)});else{let a=document.createElement("div");a.className="container-fluid";mainPanier.appendChild(a);let b=document.createElement("p");b.classList.add("text-center","lead");b.textContent="Votre panier est vide :(";a.appendChild(b)}function produitSupprimer(a){products=products.filter(b=>b._id!==a);localStorage.setItem("produit",JSON.stringify(products));0==products&&localStorage.clear();document.location.href="panier.html"}
function prixTotalCalculer(){return products.reduce((a,b)=>a+b.totalPrice,0)}let firstName=document.getElementById("prenom"),lastName=document.getElementById("nom"),address=document.getElementById("adresse"),city=document.getElementById("ville"),email=document.getElementById("email"),form=document.getElementById("submitForm"),boutonEnvoyerFormulaire=document.getElementById("envoyerFormulaire");
boutonEnvoyerFormulaire.addEventListener("click",a=>{a.preventDefault();a={firstName:firstName.value,lastName:lastName.value,address:address.value,city:city.value,email:email.value};localStorage.setItem("contact",JSON.stringify(a));""==firstName||""==lastName||""==address||""==city||""==email?alert("Tous les champs sont requis"):fetch("http://localhost:3000/api/cameras/order",{method:"POST",body:JSON.stringify({contact:a,products}),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})}).then(b=>
{if(b.ok)return b.json();Promise.reject(b.status)}).then(b=>{localStorage.setItem("orderId",b.orderId);window.location.href="confirm.html"}).catch(b=>{console.log(b)})});form.addEventListener("submit",a=>{a.preventDefault();let b=document.querySelectorAll("input");b.forEach(c=>{resetField(c)});let d=!0;b.forEach(c=>{validateField(c)||(d=!1)});d&&a.target.submit()},!1);
function validateField(a){if(a.checkValidity())return!0;a.classList.add("invalid");a.previousElementSibling.insertAdjacentHTML("beforeend",`<span class="msg">  ${a.validationMessage}</span>`);return!1}function resetField(a){let b=a.previousElementSibling;for(a.classList.remove("invalid");b.firstElementChild;)b.removeChild(b.firstElementChild);a.valid=!0};